<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.admin.modules.sys.dao.DispatchDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.admin.modules.sys.entity.vo.DispatchVo" id="dispatchMap">
        <result property="id" column="id"/>
        <result property="month" column="month"/>
        <result property="areaName" column="area_name"/>
        <result property="cityName" column="city_name"/>
        <result property="siteName" column="site_name"/>
        <result property="erpNumber" column="erp_number"/>
        <result property="courierName" column="courier_name"/>
        <result property="cardId" column="card_id"/>
        <result property="allOrderCount" column="all_order_count"/>
        <result property="totalOrderCount" column="total_order_count"/>
        <result property="totalMoney" column="total_money"/>
        <result property="fineMoney" column="fine_money"/>
        <result property="deductMoney" column="deduct_money"/>
        <result property="salary" column="salary"/>
        <result property="remark" column="remark"/>
    </resultMap>

    <select id="queryPage" resultType="com.admin.modules.sys.entity.vo.DispatchVo">
        SELECT a.id
             , a.month
             , g.name        AS area_name
             , f.name        AS city_name
             , e.name        AS site_name
             , c.erp_number
             , b.name        AS courier_name
             , b.card_id
             , a.all_order_count
             , a.total_order_count
             , a.total_money
             , a.fine_money
             , a.deduct_money
             , a.salary
             , a.remark
        FROM tb_dispatch a
               LEFT JOIN tb_erp c ON a.erp_id = c.id
               LEFT JOIN tb_courier b ON c.id = b.erp_id AND a.erp_id = b.erp_id
               LEFT JOIN tb_company d ON c.company_id = d.id
               LEFT JOIN tb_site e ON e.id = b.site_id
               LEFT JOIN tb_city f ON f.id = e.city_id
               LEFT JOIN tb_area g ON g.id = f.area_id
        WHERE 1 = 1
        <if test="courierName != null and courierName != ''">
            AND b.name = #{courierName}
        </if>
        <if test="month != null and month != ''">
            AND a.month = #{month}
        </if>
        <if test="cardId != null and cardId != ''">
            AND b.card_id = #{cardId}
        </if>
        <if test="companyId != null and companyId != ''">
            AND b.company_id = #{companyId}
        </if>
        <if test="status != null">
            AND b.status = #{status}
        </if>
        <if test="pactId != null and pactId != ''">
            AND b.pact_id = #{pactId}
        </if>
        <if test="cityId != null and cityId != ''">
            AND b.city_id = #{cityId}
        </if>
        <if test="areaId != null and areaId != ''">
            AND b.area_id = #{areaId}
        </if>
        <if test="siteId != null and siteId != ''">
            AND b.site_id = #{siteId}
        </if>
          AND a.is_delete = 0
    </select>

</mapper>